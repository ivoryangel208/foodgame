import pickle
import random

# ----- Player Class ----- 
class Player:
    def __init__(self):
        self.level = 1
        self.money = 100
        self.fish_caught = []
        self.crops_grown = []
        self.tools_owned = []
        self.npcs_met = []
        self.inventory = {}
        self.quest_log = []

    def catch_fish(self, fish):
        self.fish_caught.append(fish)
        self.log_action(f"Caught {fish['name']}")

    def grow_crop(self, crop):
        self.crops_grown.append(crop)
        self.log_action(f"Grew {crop['name']}")

    def log_action(self, action):
        print(f"Action Logged: {action}")

    def purchase_item(self, item, price):
        if self.money >= price:
            self.money -= price
            self.inventory[item] = self.inventory.get(item, 0) + 1
            self.log_action(f"Purchased {item} for {price} coins")
        else:
            print("Not enough money")

    def sell_item(self, item, quantity, price):
        if self.inventory.get(item, 0) >= quantity:
            self.inventory[item] -= quantity
            return price * quantity
        else:
            print("You don't have enough of that item")
            return 0

# ----- Inventory and Item Management ----- 
class Inventory:
    def __init__(self):
        self.items = {}

    def add_item(self, item, quantity):
        if item in self.items:
            self.items[item] += quantity
        else:
            self.items[item] = quantity

    def view_inventory(self):
        return self.items

# ----- Store Class ----- 
class Store:
    def __init__(self):
        self.store_items = {
            "Fishing Rod": {"price": 50, "type": "Tool"},
            "Seeds": {"price": 10, "type": "Crop"},
            "Bait": {"price": 5, "type": "Item"}
        }

    def show_items(self):
        return self.store_items

    def sell_item(self, player, item_name):
        item = self.store_items.get(item_name)
        if item and player.money >= item['price']:
            player.purchase_item(item_name, item['price'])
            return f"Purchased {item_name} for {item['price']} coins"
        else:
            return "Not enough coins or item unavailable"

# ----- NPC Class ----- 
class NPC:
    def __init__(self, name, quests):
        self.name = name
        self.quests = quests

    def give_quest(self, player):
        if self.quests:
            quest = self.quests.pop(0)
            player.quest_log.append(quest)
            print(f"{self.name} gave you the quest: {quest['description']}")
            return quest
        else:
            print(f"{self.name} has no more quests.")
            return None

# ----- Farm Class ----- 
class Farm:
    def __init__(self):
        self.seasons = ["Spring", "Summer", "Fall", "Winter"]
        self.weather_effects = {"Spring": 1.1, "Summer": 1.2, "Fall": 1.0, "Winter": 0.8}

    def plant_crop(self, crop, season):
        growth_rate = self.weather_effects.get(season, 1)
        print(f"Planted {crop} in {season}. Growth rate: {growth_rate}")
        return crop

# ----- Fish and Animal Class ----- 
class Fish:
    def __init__(self, name, weight, length, rarity, species, price, description, nickname):
        self.name = name
        self.weight = weight
        self.length = length
        self.rarity = rarity
        self.species = species
        self.price = price
        self.description = description
        self.nickname = nickname

# ----- Random Fish Generator ----- 
def generate_random_fish():
    fish_names = ["Salmon", "Trout", "Bass", "Catfish", "Perch"]
    species = ["Freshwater", "Saltwater"]
    rarities = ["Common", "Uncommon", "Rare", "Epic", "Legendary"]
    name = random.choice(fish_names)
    weight = round(random.uniform(1, 10), 2)
    length = round(random.uniform(20, 100), 2)
    rarity = random.choice(rarities)
    species_type = random.choice(species)
    price = random.randint(10, 500)
    description = f"A {rarity} {name}. Known for its size and challenge to catch."
    nickname = f"{name}_#{random.randint(100, 999)}"
    
    return Fish(name, weight, length, rarity, species_type, price, description, nickname)

# ----- Saving and Loading Game ----- 
def save_game(player):
    with open('savegame.pkl', 'wb') as f:
        pickle.dump(player, f)

def load_game():
    try:
        with open('savegame.pkl', 'rb') as f:
            return pickle.load(f)
    except FileNotFoundError:
        print("No saved game found. Starting fresh.")
        return Player()

# ----- Game Loop ----- 
def game_loop():
    # Initialize game
    player = load_game()
    store = Store()
    farm = Farm()

    print("Welcome to the game!")

    while True:
        print("\n--- Main Menu ---")
        print("1. View Inventory")
        print("2. Catch Fish")
        print("3. Grow Crops")
        print("4. Visit Store")
        print("5. View Quest Log")
        print("6. Save & Quit")
        
        choice = input("Choose an option: ")

        if choice == "1":
            print(player.inventory.view_inventory())

        elif choice == "2":
            fish = generate_random_fish()
            player.catch_fish(fish.__dict__)
            print(f"Caught a {fish.name} - {fish.nickname}")

        elif choice == "3":
            crop = "Wheat"
            season = random.choice(farm.seasons)
            farm.plant_crop(crop, season)

        elif choice == "4":
            print("Store Items: ")
            items = store.show_items()
            for item in items:
                print(f"{item}: {items[item]['price']} coins")
            item_to_buy = input("Which item do you want to buy? ")
            print(store.sell_item(player, item_to_buy))

        elif choice == "5":
            print("Quest Log:")
            for quest in player.quest_log:
                print(quest)

        elif choice == "6":
            save_game(player)
            print("Game saved. Exiting.")
            break

        else:
            print("Invalid choice. Try again.")

if __name__ == "__main__":
    game_loop()
